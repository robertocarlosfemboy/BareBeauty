<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>BareBeauty - Cadastre-se</title>
        <script src="login.js"></script>
        <style>
            .quadradoCadastro{
                text-align: center;
                margin-top: 13%;
                margin-left: 55%;   
                margin-right: 19%;
                padding: 1%;
                border-radius: 15px;
                background-color: #E3CBFF;
            }
            p{
                margin-left: 55%;   
                margin-right: 19%;
            }
            label{
                display: block;
                margin-bottom: px;
                margin-top: 25px;
            }
            button{
                margin-bottom: 34px;
                margin-top: 25px;
            }
            body{
                background-image: url("imagens/imagemCadastro.jpg"); 
                background-size: cover;
            }
            @font-face{
                font-family: "m";
                src: url('fontes/Marcellus/Marcellus-Regular.ttf') format('truetype');
            }
            @font-face{
                font-family: "j";
                src: url('fontes/Josefin_Sans/JosefinSans-VariableFont_wght.ttf') format('truetype');
            }
        </style>
    </head>
    <body>
        <div class="quadradoCadastro">
            <form id="idCadastro">
                <h1 style="color: #fafafa; font-size: 310%; font-family: m;">Cadastro</h1>
                <label for="nomeUsuario" style="font-size: 180%; color: #4B3E3E; font-family: j;">nome de usu√°rio:</label><br>
                <input type="text" id="nomeUsuario" required><br>

                <label for="senhaUsuario" style="font-size: 180%; color: #4B3E3E; font-family: j;">senha:</label><br>
                <input type="text" id="senhaUsuario" step="0.01" required><br>

                <button type="submit" style="color: #522586; font-size: 130%; font-family: m;">cadastrar</button>
        </div>

        <a href="login.html"><center><p>J√° possui uma conta?<br>Clique aqui!</p></center></a>

        <script>
            const form = document.getElementById("idCadastro");
    
            async function cadastroUsuario(nomeUsuario, senhaUsuario) {
                try {
                    // Seleciona a rota a ser usada
                    const resposta = await fetch('http://localhost:3000/cadastrarUsuario', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    // Encaminha os dados que vieram como parametro no corpo do arquivo JSON
                    body: JSON.stringify({
                        nomeUsuario: nomeUsuario,
                        senhaUsuario: senhaUsuario
                    })
                    });

                    // A vari√°vel dados recebe um objeto produto
                    const dados = await resposta.json();

                    if (resposta.ok) {
                        console.log("Conta cadastrada com sucesso!")
                        window.location.replace("pagina_inicial.html")
                    } else {
                        switch (resposta.status) {
                        case 400:
                            console.warn('‚ö†Ô∏è Conta n√£o encontrada');
                            break;
                        case 401:
                            console.warn('‚ö†Ô∏è Conta n√£o encontrada');
                            break;
                        case 500:
                            console.warn('üí• Erro interno no servidor. Tente novamente mais tarde.');
                            break;
                        default:
                            console.warn(`‚ùó Erro inesperado: ${resposta.status}`);
                        }

                        console.debug('Detalhes do erro:', dados.mensagem || dados);
                    }
                } 
                catch (erro) {
                    console.error('üö´ Erro ao tentar buscar o cadastro:', erro.message);
                }
            }

            form.addEventListener("submit", function(event) {
            event.preventDefault(); // impede o reload da p√°gina

            const nome = document.getElementById("nomeUsuario").value;
            const senha = parseFloat(document.getElementById("senhaUsuario").value);

            // cadastra o produto no banco de dados
            cadastroUsuario(nome, senha);
            });
        </script>
    </body>
</html>